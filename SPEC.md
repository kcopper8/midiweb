# 계이름 연주기 - 기능 스펙 문서

## 개요

웹 브라우저에서 동작하는 단일 페이지 음악 연주 도구입니다. Web Audio API를 사용하여 실시간으로 음을 생성하며, 다양한 스케일과 음색을 지원합니다.

## 기술 스택

| 항목 | 기술 |
|------|------|
| 마크업 | HTML5 |
| 스타일 | CSS3 (CSS Grid, Flexbox) |
| 스크립트 | Vanilla JavaScript (ES6+) |
| 오디오 | Web Audio API |

## 기능 명세

### 1. 음 재생

#### 1.1 기본 동작
- 버튼 클릭/터치 시 해당 음이 재생됩니다
- 기준음: C4 (261.63Hz)
- 음 길이: 0.8초 (페이드아웃 포함)

#### 1.2 주파수 계산
```
frequency = baseFrequency × 2^(semitone/12)
```

#### 1.3 지원 음역
- 기준음: C4 (261.63Hz)
- 옥타브 선택: 1, 2, 3 옥타브
- 1 옥타브: C4 ~ C5
- 2 옥타브: C4 ~ C6
- 3 옥타브: C4 ~ C7

### 2. 스케일 선택

6종의 스케일을 지원합니다.

| 스케일 | 음 개수 | 반음 간격 | 설명 |
|--------|---------|-----------|------|
| Major (장조) | 8 | 0, 2, 4, 5, 7, 9, 11, 12 | 밝고 경쾌한 느낌 |
| Minor (단조) | 8 | 0, 2, 3, 5, 7, 8, 10, 12 | 어둡고 슬픈 느낌 |
| Pentatonic (5음계) | 6 | 0, 2, 4, 7, 9, 12 | 동양적, 민속 음악 |
| Blues | 7 | 0, 3, 5, 6, 7, 10, 12 | 재즈/블루스 느낌 |
| Chromatic (반음계) | 13 | 0~12 (모든 반음) | 모든 음 포함 |
| Dorian | 8 | 0, 2, 3, 5, 7, 9, 10, 12 | 재즈 모드 |

### 3. 파형 선택

4종의 오실레이터 파형을 지원합니다.

| 파형 | 영문명 | 소리 특성 |
|------|--------|-----------|
| 사인파 | Sine | 부드럽고 순수한 소리 (기본값) |
| 사각파 | Square | 8비트 게임, 레트로 느낌 |
| 삼각파 | Triangle | 플루트, 클라리넷 느낌 |
| 톱니파 | Sawtooth | 날카롭고 풍부한 배음 |

### 4. 볼륨 조절

- 범위: 0% ~ 100%
- 기본값: 50%
- 조절 방식: 슬라이더 (range input)
- 실시간 표시: 현재 볼륨 퍼센트

### 5. UI/UX

#### 5.1 레이아웃
- 반응형 CSS Grid 레이아웃
- 화면 가로 전체를 채우는 버튼 배열
- 스케일 변경 시 그리드 열 개수 동적 조절

#### 5.2 디자인 테마
- 스타일: 미니멀 모던
- 배경색: #fafafa (밝은 회색)
- 버튼 배경: #fff (흰색)
- 활성 상태: #333 (어두운 회색)
- 그림자 효과: box-shadow 적용

#### 5.3 인터랙션
- 호버: 그림자 강화
- 클릭/터치: 배경색 반전, 글자색 변경
- 트랜지션: 0.15초 ease

#### 5.4 컨트롤 UI
- 스케일 선택: 토글 버튼 그룹
- 옥타브 선택: 토글 버튼 그룹 (1, 2, 3)
- 파형 선택: 토글 버튼 그룹
- 볼륨: 슬라이더 + 퍼센트 표시

### 6. 입력 지원

#### 6.1 마우스
- mousedown: 음 재생 시작, 활성 상태 표시
- mouseup: 활성 상태 해제
- mouseleave: 활성 상태 해제

#### 6.2 터치 (모바일)
- touchstart: 음 재생 시작, 활성 상태 표시
- touchend: 활성 상태 해제
- preventDefault로 더블탭 줌 방지

#### 6.3 키보드
키보드 3개 행을 사용하여 최대 3옥타브까지 연주할 수 있습니다.

| 행 | 키 | 옥타브 (3옥타브 모드 기준) |
|----|-----|--------------------------|
| 숫자 행 | 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, -, =, \ | 1번째 옥타브 (높은음) |
| Q 행 | Q, W, E, R, T, Y, U, I, O, P, [, ] | 2번째 옥타브 (중간음) |
| A 행 | A, S, D, F, G, H, J, K, L, ;, ' | 3번째 옥타브 (낮은음) |

- 옥타브 수에 따라 사용되는 키보드 행이 달라집니다
  - 1옥타브: A 행만 사용
  - 2옥타브: A 행 + Q 행
  - 3옥타브: A 행 + Q 행 + 숫자 행
- keydown: 음 재생 시작, 활성 상태 표시
- keyup: 활성 상태 해제
- 키 반복(repeat) 방지 처리
- 각 버튼에 단축키 힌트 표시

### 7. 음 표기

각 버튼에 두 가지 표기를 함께 표시합니다.

| 표기 | 예시 | 설명 |
|------|------|------|
| 한글 계이름 | 도, 레, 미... | 주 표시 (큰 글씨) |
| 영문 음이름 | C4, D4, E4... | 보조 표시 (작은 글씨) |

### 8. 즉석 재생 (녹음/재생)

#### 8.1 자동 녹음
- 첫 음을 연주하면 자동으로 녹음 시작
- 별도 녹음 버튼 없이 백그라운드에서 동작
- 녹음 중 인디케이터 표시 (빨간 점)

#### 8.2 녹음 모드 (설정 가능)

| 모드 | 동작 | 기본값 |
|------|------|--------|
| 시간 기반 | 마지막 음 후 N초 경과 시 자동 저장 | ✓ (3초) |
| 수동 구분 | "새 연주" 버튼으로 구분 | |
| 무한 연속 | 구분 없이 계속 녹음 | |

#### 8.3 녹음 목록
- 위치: 건반 아래 하단 고정
- 표시 정보: 녹음 시간, 연주 길이
- 최대 높이: 150px (스크롤)

#### 8.4 재생 컨트롤
- 재생/일시정지: 녹음된 연주 재생 및 일시정지
- 정지: 재생 중단 및 처음으로
- 삭제: 개별 녹음 삭제

#### 8.5 데이터 저장
- 세션 내 메모리에 저장 (새로고침 시 초기화)
- 각 음의 주파수, 시간, 파형, 볼륨 저장

### 9. 메트로놈

#### 9.1 기본 동작
- 시작/정지 버튼으로 on/off
- 클릭음 사용 (강박: 1000Hz, 약박: 800Hz)
- 짧은 클릭음 (0.05초)

#### 9.2 박자 지원

| 박자 | 패턴 |
|------|------|
| 4/4 | 똑-틱-틱-틱 (강-약-약-약) |
| 3/4 | 똑-틱-틱 (강-약-약) |

#### 9.3 템포 설정
- 범위: 40~200 BPM
- 프리셋 버튼: 60, 80, 100, 120 BPM
- 슬라이더: 세밀한 조절
- 기본값: 100 BPM

#### 9.4 UI 위치
- 상단 컨트롤 영역에 별도 행으로 배치

## 브라우저 호환성

- Chrome (권장)
- Firefox
- Safari
- Edge
- 모바일 브라우저 (iOS Safari, Android Chrome)

## 파일 구조

```
midiweb/
├── index.html          # HTML 마크업
├── css/
│   └── styles.css      # 스타일시트
├── js/
│   ├── state.js        # 중앙 상태 관리
│   ├── audio.js        # Web Audio API 래핑
│   ├── recording.js    # 녹음/재생 로직
│   ├── metronome.js    # 메트로놈 로직
│   ├── ui.js           # DOM 조작/렌더링
│   └── main.js         # 초기화/이벤트 바인딩
├── docs/
│   └── plans/          # 설계 문서
└── SPEC.md             # 기능 스펙 문서
```

## 향후 확장 가능 기능

- [x] 키보드 단축키 지원
- [x] 옥타브 확장 (1~3 옥타브)
- [ ] 연주 녹음/재생
  - [x] 즉석 재생 (세션 내 임시 녹음)
  - [ ] 저장 후 재사용 (로컬 스토리지 저장)
  - [ ] 공유 (파일 내보내기)
- [ ] 배경 반주
  - [x] 메트로놈 (리듬 가이드)
  - [ ] 드럼/비트
  - [ ] 화음 반주
- [ ] 시각적 애니메이션 효과
- [ ] 사용자 정의 스케일
- [ ] MIDI 입력 지원
